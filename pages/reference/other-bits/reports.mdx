import CustomCallout from "../../../components/CustomCallout/CustomCallout";

## Query API

### Overview
The Query API allows you to obtain the same calculated and formatted results that you see from a report in our web app.

The query endpoints should serve as the starting point for exporting user information from Mixpanel. This is done through the /engage endpoint. See the Export section for information on exporting event data.

The Mixpanel Query API endpoints can:

- Filter or break down Events
- Return user profiles.
- Return an activity/event stream for a user.
- Return a cohort of users.
- And more!


### Authentication

#### Service Account
[Service Account Authentication Details](/reference/other-bits/authentication#service-accounts)
<CustomCallout type="success" title="This is the preferred authentication method for Query API." />

- Requests parameters must include a `project_id`. 

**Projects with [Data Views](https://help.mixpanel.com/hc/en-us/articles/360043782572-Data-Views)**
- In addition to `project_id`, you should include the global data view's `workspace_id` as a request parameter.

**Projects with [Classified Data](https://help.mixpanel.com/hc/en-us/articles/360044295131-Data-Classification)**
- Your results may be filtered based on the Service Account's sensitivity settings.

#### Project Secret

<CustomCallout type="error" title="Please migrate existing integrations to use Service Account authentication">
  Project Secret authentication is in the process of being deprecated. This authentication method does not currently have an EOL date.
</CustomCallout>


### Insights

#### Query Saved Report
Get data from your Insights reports.

```sh
curl --request GET \
     --url https://mixpanel.com/api/query/insights \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/insights-query).

### Funnels

#### Query Saved Report
Get data for a funnel.

```sh
curl --request GET \
     --url https://mixpanel.com/api/query/funnels \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/funnels-query).

#### List Saved Funnels
Get the names and funnel_ids of your funnels.

```sh
curl --request GET \
     --url https://mixpanel.com/api/query/funnels/list \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/funnels-list-saved).

### Retention

#### Query Retention Report
Get cohort analysis.

If you specify neither an `interval` nor a `unit`, the `interval` is 1 day. This means that each user gets 24 hours in each interval to do the specified event.\n\nAn example response with a `born_event` of 'event integration' and `event` of 'viewed report' might look like this:
```json
    {
        "2012-01-01": {
            "counts": [2, 1, 2], "first": 2
        },
        "2012-01-02": {
            "counts": [9, 7, 6], "first": 10
        },
        "2012-01-03": {
            "counts": [9, 6, 4], "first": 10
        }
    }
```

These results indicate that on 2012-01-02, 10 users did the `born_event` (\"event integration\"), as indicated by the first field. If the `retention_type=compounded`, then first will instead indicate the number of users who did `event` (\"viewed report\") on the specified date. 9 of those users did `event` (\"viewed report\") within 24 hours (the \"0th\" interval) of doing the `born_event`. Seven of those did `event` between 24 and 48 hours (interval 1) of the `born_event`. These 7 are a subset of the initial 10, but not necessarily a subset of the 9 (retention is not a funnel; see the number increase between 72 and 96 hours). And finally, 6 users did `event` between 48 and 72 hours (interval 2) after the `born_event`.

In the Mixpanel retention UI, \"First time\" corresponds to `retention_type=birth`, and \"Recurring\" corresponds to `retention_type=compounded`.

```sh
curl --request GET \
     --url https://mixpanel.com/api/query/retention \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/retention-query).

#### Query Frequency Report
Get data about how frequently users are performing events.\n\nLet's breakdown an example response. If you specify `day` as \"unit\" and `hour` as \"addiction_unit\", you will get a response that looks like this:

```json
    {
        "2012-01-01": [305, 107, 60, 41, 32, 20, 12, 7, 4, 3, 3, 3, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        "2012-01-02": [495, 204, 117, 77, 53, 36, 26, 20, 12, 7, 4, 3, 3, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0],
        "2012-01-03": [671, 324, 176, 122, 81, 63, 48, 31, 21, 14, 9, 5, 3, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0]
    }
```

One day's worth of data is shown for each date, split into hours. On 2012-01-02, 495 users did the event `Viewed report` during at least 1 hour out of the next 24 hour period (the period specified by `unit`). 204 users did the event during at least 2 hours. 117 users did the event during at least 3 hours.

```sh
curl --request GET \
     --url 'https://mixpanel.com/api/query/retention/addiction?unit=day&addiction_unit=hour' \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/retention-frequency-query).


### Segmentation

#### Query Segmentation Report
Get data for an event, segmented and filtered by properties.

```sh
curl --request GET \
     --url https://mixpanel.com/api/query/segmentation \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/segmentation-query).

#### Numerically Bucket
Get data for an event, segmented and filtered by properties, with values placed into numeric buckets.

```sh
curl --request GET \
     --url https://mixpanel.com/api/query/segmentation/numeric \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/segmentation-numeric-query).

#### Numerically Sum
Sums an expression for events per unit time.

```sh
curl --request GET \
     --url https://mixpanel.com/api/query/segmentation/sum \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/segmentation-sum-query).

#### Numerically Average
Averages an expression for events per unit time.

```sh
curl --request GET \
     --url https://mixpanel.com/api/query/segmentation/average \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/segmentation-query-average).


### Activity Feed

#### Profile Event Activity
This endpoint returns the activity feed for specified users.

```sh
curl --request GET \
     --url https://mixpanel.com/api/query/stream/query \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/activity-stream-query).


### Cohorts

#### List Saved Cohorts
The list endpoint returns all of the cohorts in a given project. The JSON formatted return contains the cohort name, id, count, description, creation date, and visibility for every cohort in the project.

If you're trying to get a list of users in a cohort, you can use the [`/engage` endpoint with the `filter_by_cohort` parameter](/reference/other-bits/reports#engage).

```sh
curl --request POST \
     --url https://mixpanel.com/api/query/cohorts/list \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/cohorts-list).


### Engage

#### Query Profiles
Query user profile data and return list of users that fit specified parameters.

API responses will return at most `page_size` records for each request. To request additional records, callers should repeat their call to the api using the same `where` param, but provide a `session_id` parameter with a value taken from the first response, and include a `page` parameter with a value one greater than the value of page in the response.

A caller trying to retrieve all of the records for a particular query might use an algorithm something like this:

```javascript
// Get the first page of data associated with our selector expression
this_page = query_api(where=YOUR_SELECTOR_EXPRESSION)
do_something_with_response(this_page)

// If we get fewer records than the page_sized returned with our results,
// then there are no more records to get. Otherwise, keep querying for additional pages.
while (length of this_page.results) >= this_page.page_size:
    next_page_number = this_page.page + 1
    this_page = query_api(where=YOUR_SELECTOR_EXPRESSION, session_id=this_page.session_id, page=next_page_number)
    do_something_with_response(this_page)
```

Here's a curl example of this API:

```sh
curl --request POST \
     --url https://mixpanel.com/api/query/engage \
     --header 'accept: application/json' \
     --header 'content-type: application/x-www-form-urlencoded'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/engage-query).

### Event Breakdown

#### Aggregate Event Counts
Get unique, total, or average data for a set of events over N days, weeks, or months.

```sh
curl --request GET \
     --url 'https://mixpanel.com/api/query/events?type=general&unit=minute' \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/list-recent-events).


#### Today's Top Events
Get the top events for today, with their counts and the normalized percent change from yesterday.

```sh
curl --request GET \
     --url 'https://mixpanel.com/api/query/events/top?type=general' \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/query-top-events).


#### Top Events
Get a list of the most common events over the last 31 days.

```sh
curl --request GET \
     --url 'https://mixpanel.com/api/query/events/names?type=general' \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/query-months-top-event-names).


#### Aggregrated Event Property Values
Get unique, total, or average data for of a single event and property over days, weeks, or months.

```sh
curl --request GET \
     --url 'https://mixpanel.com/api/query/events/properties?type=general&unit=minute' \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/query-event-properties).

#### Top Event Properties
Get the top property names for an event.

```sh
curl --request GET \
     --url 'https://mixpanel.com/api/query/events/properties/top' \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/query-events-top-properties).


#### Top Event Property Values
Get the top values for a property.

```sh
curl --request GET \
     --url 'https://mixpanel.com/api/query/events/properties/values' \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/query-events-top-property-values).


### JQL

#### Custom JQL Query
The HTTP API is the lowest-level way to use JQL. At its core, the API is very simple: you write a script, and you post it to an API endpoint with some authentication parameters.

For longer scripts, you will likely want to keep the code in a file. If you had your script in a file called my_query.js, you could run it using the following cURL command:

```sh
curl https://mixpanel.com/api/query/jql \
     -u YOUR_API_SECRET: \
     --data-urlencode script@my_query.js
```

Note
- Queries will timeout after 2 minutes of run-time.
- You cannot make remote network requests (using XMLHttpRequest) from JavaScript.

```sh
curl --request POST \
     --url https://mixpanel.com/api/query/jql \
     --header 'accept: application/json' \
     --header 'content-type: application/x-www-form-urlencoded'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/query-jql). Check out our [JQL Overview](/docs/other-bits/jql-overview) for more information about JQL.
