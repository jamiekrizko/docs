import CustomCallout from "../../../components/CustomCallout/CustomCallout";

## Lexicon Schemas API

### Overview
Sync your internal data dictionary or tracking plan with Mixpanel using Schemas. A Schema is used to describe the data you are sending to Mixpanel and represents an individual entry into your data dictionary. Schemas that you upload will be used to populate Lexicon and provide additional context for your data across the query UI. A Schema represents a single entity (usually an event) and is defined with json-schema.

#### Lexicon UI vs Lexicon Schemas API
The data returned from the Lexicon Schemas API is most likely *not* 1:1 with the data you see in Lexicon. This because **schemas are a subset of the data that appears in Lexicon**. The Lexicon UI shows you events & properties that either:
1. have an associated schema **or**
2. have been sent to your project in the last 30 days (sometimes the look-back period is shorter depending on your data volume).

The Lexicon Schemas API only returns events with associated schemas. If an event that you see in Lexicon has no associated schema, it will not be returned by the Lexicon Schemas API. If a property on an event is not specified in the event schema, it will not be returned by the Lexicon Schemas API.

#### When is a Lexicon Schema created?
A schema is created and associated to an event in a few different ways:
1) By uploading a schema through this API
2) By importing Lexicon entries via CSV
3) By adding metadata in the UI (such as adding a description, hiding/showing, adding tags, etc.)

#### How can I export all of my data from Lexicon?
As mentioned above, the Lexicon Schemas API is unlikely to return all of the data you see in Lexicon. If you want all of the data, you can do a CSV export from the Lexicon UI. The resulting CSV will contain events and properties that have associated schemas and events and properties that were sent in the last 30 days even if they do not have associated schemas.

#### Example
The following is an example of how an event can be described by a schema:

Event
```json
{
      "event": "Added to Cart",
      "properties": {
          "item_name": "Blue Widget",
          "item_id": 12345,
          "item_price": 25.35
    }
}
```

Schema
```json
{
    "$schema": "http://json-schema.org/draft-07/schema",
    "description": "Tracked when a user adds an item to their cart.",
    "required": [
        "item_name",
        "item_id",
        "item_price"
    ],
    "additionalProperties": true,
    "properties": {
        "item_name": {
            "type": "string",
            "description": "The name of the item",
            "examples": [
                "Blue Widget"
            ]
        },
        "item_id": {
            "type": "integer",
            "description": "The internal id of the item",
            "examples": [
                12345
            ]
        },
        "item_price": {
            "type": "number",
            "description": "The current price of the item",
            "examples": [
                25.35
            ]
        }
    }
}
```

### Authentication

#### Service Account

<CustomCallout type="info" title="Roles & Permissions">
    To modify (create, edit, delete) a schema, the Service Account must have the role of admin or owner.
</CustomCallout>

[Service Account Authentication Details](/reference/other-bits/authentication#service-accounts)

Projects with [Classified Data](/docs/admin/data-governance/data-views-data-classification#data-classification)
- The Service Account must have permission to access classified data.

### Retrieve Schemas

#### List Schemas
List all schemas in a project

```sh
curl --request GET \
     --url https://mixpanel.com/api/app/projects/projectId/schemas \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/list-all-schemas-for-project).

#### List for Entity
Get all schemas for a specific entity type

```sh
curl --request GET \
     --url https://mixpanel.com/api/app/projects/projectId/schemas/event \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/list-schemas-for-entity).

#### List for Entity and Name
Get the schema for a specific entity type and entity name

```sh
curl --request GET \
     --url https://mixpanel.com/api/app/projects/projectId/schemas/event/name \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/list-schemas-by-entity-and-name).


### Create Schemas

#### Create/Replace Multiple
Upload schemas in bulk to the specified project. If a schema already exists for a specified entity, it will be replaced by the one you upload.

<CustomCallout type="warning" title="Metadata merging behavior">
    If the new schema is missing `metadata` properties that are currently set in the existing schema for that entity, those properties will be merged into the new schema. For example, if your current schema has `{"metadata": {"com.mixpanel": {"hidden": true}}}` and you upload a new schema without `"hidden"`, we will merge `"hidden": true` to your uploaded schema's metadata. If you want to remove that property, set the value to `null`.
</CustomCallout>

<CustomCallout type="info" title="Adding a schema for User Profiles">
    To add a schema for your [User Profiles](https://help.mixpanel.com/hc/en-us/articles/115004501966-User-Profiles), specify the `entityType` as `profile` and the `name` as `$user`.
</CustomCallout>

```sh
curl --request POST \
     --url https://mixpanel.com/api/app/projects/projectId/schemas \
     --header 'accept: application/json' \
     --header 'content-type: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/upload-schemas-for-project).

##### Example POST Body
```json
{
    "entries": [
        {
            "entityType": "event",
            "name": "Added To Cart",
            "schemaJson": {
                "$schema": "http://json-schema.org/draft-07/schema",
                "description": "Tracked when a user adds an item to their cart.",
                "required": [
                    "item_name",
                    "item_id",
                    "item_price"
                ],
                "additionalProperties": true,
                "metadata": {
                    "com.mixpanel": {
                        "tags": [
                            "Shopping",
                            "KPIs"
                        ],
                        "displayName": "Item Purchased",
                        "hidden": false,
                        "dropped": false,
                        "owners": [
                            {
                                "name": "Pat Davis",
                                "email": "pat.david@mixpanel.com"
                            }
                        ]
                    }
                },
                "properties": {
                    "item_name": {
                        "type": "string",
                        "description": "The name of the item",
                        "examples": [
                            "Blue Widget"
                        ],
                        "metadata": {
                          "com.mixpanel": {
                            "displayName": "Item Name"
                          }
                        }
                    },
                    "item_id": {
                        "type": "integer",
                        "description": "The internal id of the item",
                        "examples": [
                            12345
                        ],
                        "metadata": {
                          "com.mixpanel": {
                              "displayName": "Item ID"
                          }
                        }
                    },
                    "item_price": {
                        "type": "number",
                        "description": "The current price of the item",
                        "examples": [
                            25.35
                        ],
                        "metadata": {
                          "com.mixpanel": {
                            "displayName": "Price"
                          }
                        }
                    },
                    "promo_id": {
                        "type": "integer",
                        "description": "The id of any promo in progress for this item",
                        "examples": [
                            82523,
                            18382
                        ],
                        "metadata": {
                          "com.mixpanel": {
                            "displayName": "Promo ID"
                          }
                        }
                    },
                    "date_added_to_catalog": {
                        "type": "string",
                        "format": "date-time",
                        "description": "The date this item was added to the store catalog",
                        "examples": [
                            "2015-03-05T15:25:23"
                        ],
                        "metadata": {
                          "com.mixpanel": {
                            "displayName": "Date Added"
                          }
                        }
                    }
                }
            }
        }
    ],
    "truncate": false
}
```

#### Create/Replace One
Upload a schema for a single entity. If a schema already exists for a specified entity, it will be replaced by the one you upload.

<CustomCallout type="warning" title="Metadata merging behavior">
    If the new schema is missing `metadata` properties that are currently set in the existing schema for that entity, those properties will be merged into the new schema. For example, if your current schema has `{"metadata": {"com.mixpanel": {"hidden": true}}}` and you upload a new schema without `"hidden"`, we will merge `"hidden": true` to your uploaded schema's metadata. If you want to remove that property, set the value to `null`.
</CustomCallout>

<CustomCallout type="info" title="Adding a schema for User Profiles">
    To add a schema for your [User Profiles](https://help.mixpanel.com/hc/en-us/articles/115004501966-User-Profiles), specify the `entityType` as `profile` and the `name` as `$user`.
</CustomCallout>

```sh
curl --request POST \
     --url https://mixpanel.com/api/app/projects/projectId/schemas/event/name \
     --header 'accept: application/json' \
     --header 'content-type: application/json' \
     --data '
{
  "metadata": {
    "com.mixpanel": {
      "hidden": false,
      "dropped": false
    }
  }
}
'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/upload-schema-by-entity-and-name).


##### Example POST body
```json
{
    "$schema": "http://json-schema.org/draft-07/schema",
    "description": "Tracked when a user adds an item to their cart.",
    "required": [
        "item_name",
        "item_id",
        "item_price"
    ],
    "additionalProperties": true,
    "metadata": {
        "com.mixpanel": {
            "tags": [
                "Shopping",
                "KPIs"
            ],
            "displayName": "Item Purchased",
            "hidden": false,
            "dropped": false,
            "owners": [
                {
                    "name": "Pat Davis",
                    "email": "pat.david@mixpanel.com"
                }
            ]
        }
    },
    "properties": {
        "item_name": {
            "type": "string",
            "description": "The name of the item",
            "examples": [
                "Blue Widget"
            ],
            "metadata": {
              "com.mixpanel": {
                "displayName": "Item Name"
              }
            }
        },
        "item_id": {
            "type": "integer",
            "description": "The internal id of the item",
            "examples": [
                12345
            ],
            "metadata": {
              "com.mixpanel": {
                "displayName": "Item ID"
              }
            }
        },
        "item_price": {
            "type": "number",
            "description": "The current price of the item",
            "examples": [
                25.35
            ],
            "metadata": {
              "com.mixpanel": {
                "displayName": "Price"
              }
            }
        },
        "promo_id": {
            "type": "integer",
            "description": "The id of any promo in progress for this item",
            "examples": [
                82523,
                18382
            ],
            "metadata": {
              "com.mixpanel": {
                "displayName": "Promo ID"
              }
            }
        },
        "date_added_to_catalog": {
            "type": "string",
            "format": "date-time",
            "description": "The date this item was added to the store catalog",
            "examples": [
                "2015-03-05T15:25:23"
            ],
            "metadata": {
              "com.mixpanel": {
                "displayName": "Date Added"
              }
            }
        }
    }
}
```

### Delete Schema

#### Delete all Schemas
Delete all schemas in a project

```sh
curl --request DELETE \
     --url https://mixpanel.com/api/app/projects/projectId/schemas \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/delete-all-schemas-in-project.

#### Delete for Entity
Delete all schemas of a specific entity type

```sh
curl --request DELETE \
     --url https://mixpanel.com/api/app/projects/projectId/schemas/event \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/delete-schemas-for-entity).

#### Delete for Entity and Name
Delete schema for an entity type and entity name

```sh
curl --request DELETE \
     --url https://mixpanel.com/api/app/projects/projectId/schemas/event/name \
     --header 'accept: application/json'
```

To see this API in action, visit our [API Playground](https://developer.mixpanel.com/reference/delete-schema-by-entity-and-name).

### Limits
The Schemas API imposes an **8mb body size** limit and the request cannot take longer than **two minutes**. If you are running up against these limits, we suggest breaking your request into smaller batches. Usually these limits are only hit if you are attempting to do a bulk create/update.